{
  "hash": "81425f18c2acfc26e9102fbef04999f9",
  "result": {
    "markdown": "---\ntitle: \"Tidyverse\"\nauthor: \"Sneha Para\"\n---\n\n\nLast compiled: 2024-04-30\n\n# Challenge 1 : Analyze the sales by location (state)\n\n\n::: {.cell hash='01_tidyverse_cache/html/plot_13e1c0c380aa2af56aefb97cca2f0185'}\n\n```{.r .cell-code}\n#import libraries\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(lubridate)\n\n#load files\nbikes_tbl      <- read_excel (\"F://Sneha/ss24-bdsb-SnehaPara/Dataset/01_bike_sales/01_raw_data/bikes.xlsx\") \norderlines_tbl <- read_excel (\"F:/Sneha/ss24-bdsb-SnehaPara/Dataset/01_bike_sales/01_raw_data/orderlines.xlsx\") \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> New names:\n#> • `` -> `...1`\n```\n:::\n\n```{.r .cell-code}\nbikeshops_tbl  <- read_excel(\"F:/Sneha/ss24-bdsb-SnehaPara/Dataset/01_bike_sales/01_raw_data/bikeshops.xlsx\") \n\n#examine files\n\n#join files using the keys product id, bikeshop id and customer id\nbike_orderlines_joined_tbl <- orderlines_tbl %>%\n  left_join(bikes_tbl, by = c(\"product.id\" = \"bike.id\")) %>%\n  left_join(bikeshops_tbl, by = c(\"customer.id\" = \"bikeshop.id\"))\n\n#Examine the joined files \n\n# Select State as feature and examine the data \n\n# wrangle data \nbike_orderlines_wrangled_tbl <- bike_orderlines_joined_tbl %>%\n  separate(col    = location,\n           into   = c(\"city\",\"state\"),\n           sep    = \",\") %>%\n  mutate(total.price = price * quantity) %>%\n  select(-...1, -gender) %>%\n  select(-ends_with(\".id\")) %>%\n  bind_cols(bike_orderlines_joined_tbl %>% select(order.id)) %>% \n  \n  select(order.id, contains(\"order\"), contains(\"model\"), contains(\"city\"),state,\n         price, quantity, total.price,\n         everything()) %>%\n  rename(bikeshop = name) %>%\n  set_names(names(.) %>% str_replace_all(\"\\\\.\", \"_\"))\n\n#extract required column\nsales_by_year_tbl <- bike_orderlines_wrangled_tbl %>%\n  select(order_date, total_price) %>%\n  mutate(year = year(order_date)) %>%\n  group_by(year) %>% \n  summarize(sales = sum(total_price), .groups = \"drop\") %>%\n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \"€\"))\n\n\n\n#plot bar chart\nsales_by_year_tbl %>%\n  \n  # Setup canvas with the columns year (x-axis) and sales (y-axis)\n  ggplot(aes(x = year, y = sales)) +\n  \n  # Geometries\n  geom_col(fill = \"#2DC6D6\") + # Use geom_col for a bar plot\n  geom_label(aes(label = sales_text)) + # Adding labels to the bars\n  geom_smooth(method = \"lm\", se = FALSE) + # Adding a trendline\n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \"€\")) +\n  labs(\n    title    = \"Revenue by year\",\n    subtitle = \"Upward Trend\",\n    x = \"\", # Override defaults for x and y\n    y = \"Revenue\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n#> `geom_smooth()` using formula = 'y ~ x'\n```\n:::\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/plot-1.png){width=1344}\n:::\n:::\n\n\n# Challenge 2 : Analyze the sales by location (state) by year and location \n\n\n::: {.cell hash='01_tidyverse_cache/html/unnamed-chunk-1_76a58fc7a9a1070709fcafc2adabb63e'}\n\n```{.r .cell-code}\nsales_by_year_state_tbl <- bike_orderlines_wrangled_tbl %>%\n  \n  # Select columns and add a year\n  select(order_date, total_price, state) %>%\n  mutate(year = year(order_date)) %>%\n  \n  # Group by and summarize year and main catgegory\n  group_by(year, state) %>%\n  summarise(sales = sum(total_price), .groups = \"drop\") %>%\n  ungroup() %>%\n  \n  # Format $ Text\n  mutate(sales_text = scales::dollar(sales, big.mark = \".\", \n                                     decimal.mark = \",\", \n                                     prefix = \"\", \n                                     suffix = \"€\"))\n\nsales_by_year_state_tbl %>%\n  \n  ggplot(aes(x = year, y = sales, fill = state)) +\n  geom_col() + theme(axis.text.x = element_text(angle = 45, hjust = 1)) +\n  \n  facet_wrap(~ state, scales = \"free_y\") +\n  \n  scale_y_continuous(labels = scales::dollar_format(big.mark = \".\", \n                                                    decimal.mark = \",\", \n                                                    prefix = \"\", \n                                                    suffix = \"€\")) +\n  labs(\n    title = \"Revenue by year and state\",\n    subtitle = \"Each product category has an upward trend\",\n    fill = \"State\" # Changes the legend name\n  )\n```\n\n::: {.cell-output-display}\n![](01_tidyverse_files/figure-html/unnamed-chunk-1-1.png){width=1728}\n:::\n\n```{.r .cell-code}\nlibrary(\"writexl\")\nbike_orderlines_wrangled_tbl %>%\n  write_xlsx(\"bike_orderlines.xlsx\")\n# 7.2 CSV ----\nbike_orderlines_wrangled_tbl %>% \n  write_csv(\"bike_orderlines.csv\")\n\n\n# 7.3 RDS ----\n\nbike_orderlines_wrangled_tbl %>% \n  write_rds(\"bike_orderlines.rds\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}